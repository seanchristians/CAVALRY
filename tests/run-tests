#!/bin/sh

export SECRETS=".secrets.json"

PROJECT=$(realpath $(dirname $(git rev-parse --git-dir)))

# Automate finding tests to execute
cd $PROJECT/tests
FILES=$(find -executable -not -path "\." | grep -v $(basename $0))

# The base status of tests is a pass
cd $PROJECT
STATUS=0

for TEST in $FILES
do
	if [ $1 = "--silence-pass" ]
	then
		$PROJECT/tests/$TEST 1>/dev/null
	else
		$PROJECT/tests/$TEST
	fi

	STATUS=$(( $STATUS | $? )) # OR current status with return code
done

exit $STATUS
